━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  AI量化交易系统 - 多周期数据流转可视化
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

┌─────────────────────────────────────────────────────────────────────────────┐
│                          Step 1: 原始K线数据采集                              │
│                        (从币安API获取历史K线数据)                              │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
          ┌───────────────────────────┼───────────────────────────┐
          ↓                           ↓                           ↓
    ┌─────────┐                 ┌─────────┐                 ┌─────────┐
    │  5m周期 │                 │ 15m周期 │                 │  1h周期 │
    │ 300根   │                 │ 300根   │                 │ 300根   │
    └─────────┘                 └─────────┘                 └─────────┘
          │                           │                           │
          │ 归档                      │ 归档                      │ 归档
          ↓                           ↓                           ↓
    ┌─────────┐                 ┌─────────┐                 ┌─────────┐
    │4个文件  │                 │4个文件  │                 │4个文件  │
    │JSON     │                 │JSON     │                 │JSON     │
    │CSV      │                 │CSV      │                 │CSV      │
    │Parquet  │                 │Parquet  │                 │Parquet  │
    │Stats    │                 │Stats    │                 │Stats    │
    └─────────┘                 └─────────┘                 └─────────┘
          │                           │                           │
          └───────────────────────────┼───────────────────────────┘
                                      ↓

┌─────────────────────────────────────────────────────────────────────────────┐
│                      Step 2: 技术指标计算 (31列)                             │
│         (SMA, EMA, MACD, RSI, Bollinger Bands, ATR, Volume, etc.)          │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
          ┌───────────────────────────┼───────────────────────────┐
          ↓                           ↓                           ↓
    ┌─────────┐                 ┌─────────┐                 ┌─────────┐
    │  df_5m  │                 │ df_15m  │                 │  df_1h  │
    │ ✅ 计算  │                 │ ✅ 计算  │                 │ ✅ 计算  │
    │ 31列    │                 │ 31列    │                 │ 31列    │
    └─────────┘                 └─────────┘                 └─────────┘
          │                           │                           │
          │ ✅ 归档                   │ ❌ 未归档                 │ ❌ 未归档
          ↓                           │                           │
    ┌─────────┐                      │                           │
    │2个文件  │                      │                           │
    │Parquet  │                      │                           │
    │Stats    │                      │                           │
    └─────────┘                      │                           │
          │                           │                           │
          └───────────────────────────┼───────────────────────────┘
                                      ↓

┌─────────────────────────────────────────────────────────────────────────────┐
│                      Step 3: 特征工程 (81列)                                 │
│      (价格相对位置、趋势强度、动量、波动率、成交量、组合特征等)                  │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
          ┌───────────────────────────┼───────────────────────────┐
          ↓                           ↓                           ↓
    ┌─────────┐                 ┌─────────┐                 ┌─────────┐
    │feat_5m  │                 │feat_15m │                 │feat_1h  │
    │ ✅ 计算  │                 │ ✅ 计算  │                 │ ✅ 计算  │
    │ 81列    │                 │ 81列    │                 │ 81列    │
    └─────────┘                 └─────────┘                 └─────────┘
          │                           │                           │
          │ ✅ 归档                   │ ❌ 未归档                 │ ❌ 未归档
          ↓                           │                           │
    ┌─────────┐                      │                           │
    │2个文件  │                      │                           │
    │Parquet  │                      │                           │
    │Stats    │                      │                           │
    └─────────┘                      │                           │
          │                           │                           │
          └───────────────────────────┼───────────────────────────┘
                                      ↓

┌─────────────────────────────────────────────────────────────────────────────┐
│                    Step 4: 多周期上下文整合                                   │
│                  (提取并合并所有周期的关键信息)                                 │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
          ┌───────────────────────────┼───────────────────────────┐
          ↓                           ↓                           ↓
    ┌─────────┐                 ┌─────────┐                 ┌─────────┐
    │5m关键   │                 │15m关键  │                 │1h关键   │
    │指标提取 │                 │指标提取 │                 │指标提取 │
    │ ✅ 使用  │                 │ ✅ 使用  │                 │ ✅ 使用  │
    └─────────┘                 └─────────┘                 └─────────┘
          │                           │                           │
          └───────────────────────────┼───────────────────────────┘
                                      ↓
                          ┌─────────────────────┐
                          │multi_timeframe_states│
                          │   ✅ 3个周期合并     │
                          └─────────────────────┘
                                      │
                                      │ ✅ 归档
                                      ↓
                          ┌─────────────────────┐
                          │   1个JSON文件       │
                          │ (包含所有周期信息)   │
                          └─────────────────────┘
                                      ↓

┌─────────────────────────────────────────────────────────────────────────────┐
│                      Step 5: 信号生成 (LLM决策)                              │
└─────────────────────────────────────────────────────────────────────────────┘
                                      ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                      Step 6: 决策确认与验证                                   │
└─────────────────────────────────────────────────────────────────────────────┘
                                      ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                      Step 7-9: 风控、执行、监控                              │
└─────────────────────────────────────────────────────────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

                            📊 数据流转统计

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

┌─────────┬──────────┬──────────┬──────────┬──────────────────┐
│  步骤   │  5m周期  │ 15m周期  │  1h周期  │   归档策略        │
├─────────┼──────────┼──────────┼──────────┼──────────────────┤
│ Step1   │ ✅ 采集  │ ✅ 采集  │ ✅ 采集  │ 所有周期独立归档 │
│         │ ✅ 归档  │ ✅ 归档  │ ✅ 归档  │ (4个文件/周期)   │
├─────────┼──────────┼──────────┼──────────┼──────────────────┤
│ Step2   │ ✅ 计算  │ ✅ 计算  │ ✅ 计算  │ 仅5m归档         │
│         │ ✅ 归档  │ ❌ 未归档│ ❌ 未归档│ (2个文件)        │
├─────────┼──────────┼──────────┼──────────┼──────────────────┤
│ Step3   │ ✅ 计算  │ ✅ 计算  │ ✅ 计算  │ 仅5m归档         │
│         │ ✅ 归档  │ ❌ 未归档│ ❌ 未归档│ (2个文件)        │
├─────────┼──────────┼──────────┼──────────┼──────────────────┤
│ Step4   │ ✅ 使用  │ ✅ 使用  │ ✅ 使用  │ 多周期合并归档   │
│         │          │          │          │ (1个JSON文件)    │
└─────────┴──────────┴──────────┴──────────┴──────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

                            🎯 关键指标对比

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

基于最新实盘数据 (20251219_221900)

┌──────────────┬───────────┬───────────┬───────────┐
│   指标       │  5m周期   │ 15m周期   │  1h周期   │
├──────────────┼───────────┼───────────┼───────────┤
│ K线数量      │  300根    │  300根    │  300根    │
│ 时间跨度     │  ~25小时  │  ~75小时  │  ~300小时 │
│ 当前价格     │ $88,157   │  [计算]   │  [计算]   │
│ RSI          │  55.99    │  [计算]   │  [计算]   │
│ MACD         │  3.39     │  [计算]   │  [计算]   │
│ 趋势判断     │ sideways  │  [计算]   │  [计算]   │
│ 归档状态     │ ✅ 完整   │ ⚠️ 仅Step1│ ⚠️ 仅Step1│
└──────────────┴───────────┴───────────┴───────────┘

注：15m和1h周期的指标已计算但未单独归档，关键信息已整合到Step4

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

                            💡 设计理念

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 计算完整性
   - 所有3个周期都经过完整的计算流程
   - 每个周期独立计算技术指标和高级特征
   - 数据利用率 100%

✅ 归档效率
   - Step1: 全周期归档（原始数据，可回溯）
   - Step2-3: 仅归档主周期（节省存储空间）
   - Step4: 关键信息合并归档（所有周期）

✅ 决策准确性
   - 多周期共振验证（5m/15m/1h同时确认）
   - 避免单周期噪音干扰
   - 提高信号可靠性

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

生成时间: 2025-12-19 22:30:00
数据批次: 20251219_221900
系统状态: ✅ 生产就绪

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
