================================================================================
AI Trader 多周期数据流转可视化图
================================================================================

时间批次: 20251219_221900
分析时间: 2025-12-19 22:25:00

================================================================================
完整数据流向
================================================================================

┌────────────────────────────────────────────────────────────────────────────┐
│                         Step 1: 原始K线采集                                 │
│                        (从 Binance API 获取)                                │
└────────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    │               │               │
                    ↓               ↓               ↓
        ┌───────────────┐ ┌───────────────┐ ┌───────────────┐
        │  5m 周期      │ │ 15m 周期      │ │  1h 周期      │
        │  300根K线     │ │ 300根K线      │ │  300根K线     │
        │               │ │               │ │               │
        │ ✅ JSON       │ │ ✅ JSON       │ │ ✅ JSON       │
        │ ✅ CSV        │ │ ✅ CSV        │ │ ✅ CSV        │
        │ ✅ Parquet    │ │ ✅ Parquet    │ │ ✅ Parquet    │
        │ ✅ Stats      │ │ ✅ Stats      │ │ ✅ Stats      │
        │               │ │               │ │               │
        │ 4个文件       │ │ 4个文件       │ │ 4个文件       │
        └───────────────┘ └───────────────┘ └───────────────┘
                    │               │               │
                    │               │               │
                    ↓               ↓               ↓
┌────────────────────────────────────────────────────────────────────────────┐
│                      Step 2: 技术指标计算                                   │
│                   (SMA, EMA, MACD, RSI, BB, ATR等)                         │
└────────────────────────────────────────────────────────────────────────────┘
                    │               │               │
                    ↓               ↓               ↓
        ┌───────────────┐ ┌───────────────┐ ┌───────────────┐
        │  df_5m        │ │  df_15m       │ │  df_1h        │
        │  32列         │ │  32列         │ │  32列         │
        │               │ │               │ │               │
        │ ✅ 计算完成   │ │ ✅ 计算完成   │ │ ✅ 计算完成   │
        │ ✅ Parquet    │ │ ❌ 未归档     │ │ ❌ 未归档     │
        │ ✅ Stats      │ │               │ │               │
        │               │ │               │ │               │
        │ 2个文件       │ │ 0个文件       │ │ 0个文件       │
        └───────────────┘ └───────────────┘ └───────────────┘
                    │               │               │
                    │               │               │
                    ↓               ↓               ↓
┌────────────────────────────────────────────────────────────────────────────┐
│                       Step 3: 特征工程                                      │
│              (49个高级特征: 趋势、动量、波动率、成交量等)                    │
└────────────────────────────────────────────────────────────────────────────┘
                    │               │               │
                    ↓               ↓               ↓
        ┌───────────────┐ ┌───────────────┐ ┌───────────────┐
        │ features_5m   │ │features_15m   │ │ features_1h   │
        │  81列         │ │  81列         │ │  81列         │
        │               │ │               │ │               │
        │ ✅ 计算完成   │ │ ✅ 计算完成   │ │ ✅ 计算完成   │
        │ ✅ Parquet    │ │ ❌ 未归档     │ │ ❌ 未归档     │
        │ ✅ Stats      │ │               │ │               │
        │               │ │               │ │               │
        │ 2个文件       │ │ 0个文件       │ │ 0个文件       │
        └───────────────┘ └───────────────┘ └───────────────┘
                    │               │               │
                    └───────────────┼───────────────┘
                                    │
                                    ↓
┌────────────────────────────────────────────────────────────────────────────┐
│                    Step 4: 多周期上下文整合                                 │
│                 (提取关键指标，构建市场全景)                                │
└────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ↓
                    ┌───────────────────────────┐
                    │ multi_timeframe_states    │
                    │                           │
                    │ ✅ 5m:  price, rsi, macd  │
                    │        trend, volume...   │
                    │                           │
                    │ ✅ 15m: price, rsi, macd  │
                    │        trend, volume...   │
                    │                           │
                    │ ✅ 1h:  price, rsi, macd  │
                    │        trend, volume...   │
                    │                           │
                    │ ✅ JSON 归档              │
                    │                           │
                    │ 1个文件                   │
                    └───────────────────────────┘
                                    │
                                    ↓
                            [后续决策流程]

================================================================================
归档文件统计
================================================================================

Step1: 12个文件
  - 5m:  JSON + CSV + Parquet + Stats = 4个
  - 15m: JSON + CSV + Parquet + Stats = 4个
  - 1h:  JSON + CSV + Parquet + Stats = 4个

Step2: 2个文件
  - 5m:  Parquet + Stats = 2个
  - 15m: (未归档)
  - 1h:  (未归档)

Step3: 2个文件
  - 5m:  Parquet + Stats = 2个
  - 15m: (未归档)
  - 1h:  (未归档)

Step4: 1个文件
  - 多周期合并: JSON = 1个

总计: 17个文件

================================================================================
数据使用情况
================================================================================

✅ 5m 周期:
  - Step1: 采集 & 归档
  - Step2: 计算 & 归档 (32列指标)
  - Step3: 计算 & 归档 (81列特征)
  - Step4: 提取关键信息

✅ 15m 周期:
  - Step1: 采集 & 归档
  - Step2: 计算 (未归档详细数据)
  - Step3: 计算 (未归档详细数据)
  - Step4: 提取关键信息

✅ 1h 周期:
  - Step1: 采集 & 归档
  - Step2: 计算 (未归档详细数据)
  - Step3: 计算 (未归档详细数据)
  - Step4: 提取关键信息

结论: 所有3个周期的数据都被完整使用，无浪费！

================================================================================
设计逻辑说明
================================================================================

1. Step1 归档策略: 全周期归档
   - 原始K线数据是最基础的数据源
   - 保留所有周期便于后续验证和回溯
   - 存储开销小（每个周期~175KB）

2. Step2/3 归档策略: 仅主周期归档
   - 5m 是决策主周期，需要详细分析
   - 15m/1h 仅用于趋势确认，不需要详细存储
   - 关键信息已在Step4中提取和归档
   - 节省存储空间（避免×3倍文件）

3. Step4 归档策略: 多周期合并
   - 将3个周期的关键指标整合到单个JSON
   - 便于后续分析和可视化
   - 包含完整的决策依据

================================================================================
